<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Bootstrapping MPU applications using At91bootstrap loader | Harmony 3 peripheral library application examples for SAM9X60 family</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Bootstrapping MPU applications using At91bootstrap loader" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 peripheral library application examples for SAM9X60 family" /> <meta property="og:description" content="Harmony 3 peripheral library application examples for SAM9X60 family" /> <link rel="canonical" href="../../apps/docs/readme_bootstrap.html" /> <meta property="og:url" content="../../apps/docs/readme_bootstrap.html" /> <meta property="og:site_name" content="Harmony 3 peripheral library application examples for SAM9X60 family" /> <script type="application/ld+json"> {"@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"url":"../../apps/docs/readme_bootstrap.html","headline":"Bootstrapping MPU applications using At91bootstrap loader","description":"Harmony 3 peripheral library application examples for SAM9X60 family","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../index.html" class="nav-list-link">Harmony 3 peripheral library application examples for SAM9X60 family</a><ul class="nav-list "><li class="nav-list-item "><a href="../../apps/adc/adc_polled_mode/readme.html" class="nav-list-link">ADC Polling</a></li><li class="nav-list-item "><a href="../../apps/adc/adc_automatic_window_comparison/readme.html" class="nav-list-link">ADC automatic window comparison</a></li><li class="nav-list-item "><a href="../../apps/adc/adc_user_sequence/readme.html" class="nav-list-link">ADC user sequence</a></li><li class="nav-list-item "><a href="../../apps/can/can_normal_operation_blocking/readme.html" class="nav-list-link">CAN blocking</a></li><li class="nav-list-item "><a href="../../apps/can/can_normal_operation_interrupt/readme.html" class="nav-list-link">CAN interrupt</a></li><li class="nav-list-item "><a href="../../apps/can/can_normal_operation_interrupt_timestamp/readme.html" class="nav-list-link">CAN interrupt with timestamp</a></li><li class="nav-list-item "><a href="../../apps/clock/clock_config/readme.html" class="nav-list-link">Clock configuration</a></li><li class="nav-list-item "><a href="../../apps/dbgu/dbgu_echo_interrupt/readme.html" class="nav-list-link">DBGU Interrupt</a></li><li class="nav-list-item "><a href="../../apps/dbgu/dbgu_echo_blocking/readme.html" class="nav-list-link">DBGU blocking</a></li><li class="nav-list-item "><a href="../../apps/dbgu/dbgu_ring_buffer_interrupt/readme.html" class="nav-list-link">DBGU ring buffer</a></li><li class="nav-list-item "><a href="../../apps/flexcom/flexcom_spi_eeprom/readme.html" class="nav-list-link">FLEXCOM SPI EEPROM read write</a></li><li class="nav-list-item "><a href="../../apps/flexcom/flexcom_spi_self_loopback_dma/readme.html" class="nav-list-link">FLEXCOM SPI self loopback dma</a></li><li class="nav-list-item "><a href="../../apps/flexcom/flexcom_twi_eeprom/readme.html" class="nav-list-link">FLEXCOM TWI (I2C) EEPROM</a></li><li class="nav-list-item "><a href="../../apps/flexcom/flexcom_usart_echo_blocking/readme.html" class="nav-list-link">FLEXCOM USART blocking</a></li><li class="nav-list-item "><a href="../../apps/flexcom/flexcom_usart_flow_control/readme.html" class="nav-list-link">FLEXCOM USART flow control</a></li><li class="nav-list-item "><a href="../../apps/flexcom/flexcom_usart_echo_interrupt/readme.html" class="nav-list-link">FLEXCOM USART interrupt</a></li><li class="nav-list-item "><a href="../../apps/flexcom/flexcom_usart_ring_buffer_interrupt/readme.html" class="nav-list-link">FLEXCOM USART ring buffer</a></li><li class="nav-list-item "><a href="../../apps/clock/low_power/readme.html" class="nav-list-link">Low power modes</a></li><li class="nav-list-item "><a href="../../apps/otpc/otpc_read_write_emulation/readme.html" class="nav-list-link">OTPC read write (emulation)</a></li><li class="nav-list-item "><a href="../../apps/pio/pio_led_on_off_interrupt/readme.html" class="nav-list-link">PIO interrupt</a></li><li class="nav-list-item "><a href="../../apps/pio/pio_led_on_off_polling/readme.html" class="nav-list-link">PIO polling</a></li><li class="nav-list-item "><a href="../../apps/pit/period_change/readme.html" class="nav-list-link">PIT period change</a></li><li class="nav-list-item "><a href="../../apps/pit/led_toggle_polling/readme.html" class="nav-list-link">PIT polling</a></li><li class="nav-list-item "><a href="../../apps/pit/start_stop/readme.html" class="nav-list-link">PIT start stop</a></li><li class="nav-list-item "><a href="../../apps/pit64b/led_toggle_interrupt/readme.html" class="nav-list-link">PIT64B periodic interrupt</a></li><li class="nav-list-item "><a href="../../apps/pwm/pwm_channels/readme.html" class="nav-list-link">PWM channels</a></li><li class="nav-list-item "><a href="../../apps/qspi/qspi_read_write/readme.html" class="nav-list-link">QSPI flash read write</a></li><li class="nav-list-item "><a href="../../apps/rstc/led_switcher/readme.html" class="nav-list-link">RSTC interrupt</a></li><li class="nav-list-item "><a href="../../apps/rstc/rstc_reset_cause/readme.html" class="nav-list-link">RSTC reset cause</a></li><li class="nav-list-item "><a href="../../apps/rtc/rtc_alarm/readme.html" class="nav-list-link">RTC alarm interrupt</a></li><li class="nav-list-item "><a href="../../apps/rtt/rtt_alarm/readme.html" class="nav-list-link">RTT alarm interrupt</a></li><li class="nav-list-item "><a href="../../apps/rtt/rtt_periodic_timeout/readme.html" class="nav-list-link">RTT periodic interrupt</a></li><li class="nav-list-item "><a href="../../apps/shdwc/piobu0_wakeup/readme.html" class="nav-list-link">SHDWC wakeup</a></li><li class="nav-list-item "><a href="../../apps/tc/tc_capture_mode/readme.html" class="nav-list-link">TC capture mode</a></li><li class="nav-list-item "><a href="../../apps/tc/tc_compare_mode/readme.html" class="nav-list-link">TC compare mode</a></li><li class="nav-list-item "><a href="../../apps/tc/tc_timer_mode/readme.html" class="nav-list-link">TC timer mode</a></li><li class="nav-list-item "><a href="../../apps/trng/random_number/readme.html" class="nav-list-link">TRNG random number</a></li><li class="nav-list-item "><a href="../../apps/wdt/wdt_timeout/readme.html" class="nav-list-link">WDT timeout</a></li><li class="nav-list-item "><a href="../../apps/xdmac/xdmac_memory_transfer/readme.html" class="nav-list-link">XDMAC memory transfer</a></li></ul></li><li class="nav-list-item active"><a href="../../apps/docs/readme_bootstrap.html" class="nav-list-link active">Bootstrapping MPU applications using At91bootstrap loader</a></li><li class="nav-list-item"><a href="../../release_notes.html" class="nav-list-link">Release notes</a></li><li class="nav-list-item"><a href="../../mplab_harmony_license.html" class="nav-list-link">License</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Harmony 3 peripheral library application examples for SAM9X60 family" aria-label="Search Harmony 3 peripheral library application examples for SAM9X60 family" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <p><a href="https://www.microchip.com"><img src="https://www.microchip.com/ResourcePackages/Microchip/assets/dist/images/logo.png" alt="MCHP" /></a></p> <h1 id="bootstrapping-mpu-applications-using-at91bootstrap-loader"> <a href="#bootstrapping-mpu-applications-using-at91bootstrap-loader" aria-labelledby="bootstrapping-mpu-applications-using-at91bootstrap-loader" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Bootstrapping MPU applications using At91bootstrap loader </h1> <p>MPU applications are linked to execute from external DRAM memory that is available on the evaluation kit. This require all peripherals and clock leading to the DRAM memory to be configured prior to the application being programmed. This is done using a bootstrap loader.</p> <p>Bootstrap loader project used for this purpose is a variant of the AT91Bootstrap project available for Microchip MPUs. It can be downloaded from <a href="https://github.com/linux4sam/at91bootstrap/tree/at91bootstrap-3.x-mplabx">here</a>. This project is adapted to be used from within MPLABx IDE on both Windows and Linux.</p> <p>To facilitate the debugging and running of the MPU application, each application in this repository is bundled with its own copy of the AT91Bootstrap project. Each copy of the bootstrap project can be found under same folder as the application project and is named and is prefixed with “at91bootstrap_”. For eg: if the application folder name is sam_9x60_ek.X, then bootstrap project folder will be named at91bootstrap_sam_9x60_ek.X and will be present at the same folder level.</p> <p>Bootstrap project is configured to load and execute a raw binary file named “harmony.bin” from the SD card. SD card slot to be used shall vary with the evaluation kit.</p> <p>Each application project is configured with a post build step which will generate the necessary binary file named “harmony.bin” at the end of each build.</p> <p>If you are only interested in running or debugging the MPU applications in this repository , you can skip the following sections and and jump straight to <a href="#debugging-mpu-applications-using-mplabx">Debugging MPU application using MPLABx</a>. Each copy of the bootstrap project in this repository is preconfigured to the correct evaluation kit.Also, the bootstrap binary files required to program and run the applications are checked into the repository.</p> <h2 id="building-at91bootstrap-project"> <a href="#building-at91bootstrap-project" aria-labelledby="building-at91bootstrap-project" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Building AT91Bootstrap project </h2> <ul> <li> <p>Bootstrap project can be configured using MPLABx using its KCONFIG menu. To do this, open the project in MPLABx, right click on the project and select “properties”. In categories, select “Kconfig” as shown below:</p> <p><img src="../../apps/docs/images/kconfig.png" alt="kconfig" /></p> </li> <li>Click on “LOAD” button and navigate to the boards folder inside the project. Choose the a default configuration file (defconfig) config file to select a target evaluation board and boot method <ul> <li>For eg: If you want to boot harmony.bin file from sd card for SAM9X60 evaluation kit, navigate to board/sam9x60ek folder and select “sam9x60eksd_harmony_defconfig” file</li> </ul> </li> <li> <p>Click on “Apply” and “OK” buttons to configure the project</p> </li> <li> <p>Build the project to generate the bootstrap binaries</p> </li> <li><em>Note: At91bootstrap project requires arm-gcc to build it. XC32 toolchain is not supported yet</em></li> </ul> <h2 id="configure-mplabx-application-to-use-at91bootstrap-loader"> <a href="#configure-mplabx-application-to-use-at91bootstrap-loader" aria-labelledby="configure-mplabx-application-to-use-at91bootstrap-loader" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configure MPLABx application to use AT91Bootstrap loader </h2> <p>MPLABx debugger relies on AT91Bootstrap to configure the board before programming the application binaries. To configure an application to use AT91Bootstrap, follow the steps detailed below:</p> <h3 id="configure-a-debug-tool"> <a href="#configure-a-debug-tool" aria-labelledby="configure-a-debug-tool" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configure a debug tool </h3> <ul> <li> <p>Right click on the application project and select properties. This will open the properties window. In the configuration option –&gt; connected hardware tools, select the debugger.</p> <p><img src="../../apps/docs/images/select_debug.png" alt="select_debugger" /></p> <p><em>Note: if no debugger is connected, click on the “show all” check box and select the supported debugger. Only Jlink options are supported</em></p> </li> <li> <p>Select the target toolchain and click on apply to save the changes</p> </li> <li> <p>This will result in an additional menu option to be available in the configuration tree view called “bootstrap” as shown below:</p> <p><img src="../../apps/docs/images/debug_bootstrap.png" alt="show_bootstrap" /></p> </li> </ul> <h3 id="configure-bootstrap"> <a href="#configure-bootstrap" aria-labelledby="configure-bootstrap" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configure bootstrap </h3> <ul> <li> <p>Click on “Use bootstrap” check box to enable bootstrap support</p> </li> <li> <p>Click on the “LOAD” button to load the bootstrap file. This will open a file picker, which allows you to choose the bootstrap binary file.</p> </li> <li> <p>Navigate to the “binaries” folder under the AT91Bootstrap project folder. This contains the build output of the bootstrap project. You can either choose the “AT91Bootstrap.elf” file or “boot.bin” file</p> <ul> <li>If ELF file is choosen, the “Bootstrap entry address” and the “Bootstrap load address” text box can be left empty as this information can be read from the ELF file</li> <li>If BIN file is chosen, the bootstrap entry address and the load address should be filled in their corresponding text boxes</li> <li> <p>An example configuration can be seen below. Here a relative path is used with respect to the project directory, to make the configuration portable</p> <p><img src="../../apps/docs/images/configured_bootstrap.png" alt="configured_bootstrap" /></p> </li> </ul> </li> </ul> <h2 id="debugging-mpu-applications-using-mplabx"> <a href="#debugging-mpu-applications-using-mplabx" aria-labelledby="debugging-mpu-applications-using-mplabx" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debugging MPU applications using MPLABx </h2> <p>Once the applicaton is configured to use bootstrap loader, debugging the application is as simple right clicking the application and selecting “Debug” option. This will cause debugger to perform a two stage loading:</p> <p><strong>Stage 1:</strong> Loads the bootstrap loader into the internal SRAM and executes it. This will configure the board specific peripherals and memory</p> <p><strong>Stage 2:</strong> Loads the application into the external DRAM and debugs it. User can perform actions like setting breakpoints, single-stepping etc.</p> <p>Debugging the applicaton using MPLABx has the following limitations:</p> <ol> <li>Running application using debugger is not supported</li> <li>Call stack is not supported</li> <li>Step in, step out using debugger does not work</li> </ol> <p><em>Note:</em> Make sure that you reset the board between each debug sessions so that the debugger can attach to the target correctly</p> <h2 id="running-mpu-applications"> <a href="#running-mpu-applications" aria-labelledby="running-mpu-applications" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running MPU applications </h2> <p>To run the applications, copy both the application binary named “harmony.bin” and the bootstrap binary named “boot.bin” onto an SD card. Insert the SD card into the SD slot of the evaluation kit and press the reset button.</p> <p>The ROM bootloader will copy the bootstrap binary “boot.bin” into the internal SRAM and executes it. The bootstrap will configure the external DRAM and the required peripherals, then copy the applicaton binary “harmony.bin” into the DRAM and executes it.</p> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='../../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2021 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
